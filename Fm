import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;
import java.io.File;
import java.io.IOException;
import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

class FileManagerTest {

    private FileManager fileManager;  

    @Mock
    private Utilities utilities;  // ✅ Mocked Utilities class

    @BeforeEach
    void setUp() {
        MockitoAnnotations.openMocks(this);
        fileManager = new FileManager(utilities);  // ✅ Use a real instance (not mocked)
    }

    @Test
    void testVerifyDriverExists_InCurrentFolder() throws IOException {
        String path = "C:/drivers";
        String browser = "chrome";
        String destination = "C:/destination";
        String driverName = "chromedriver.exe";

        when(utilities.getDriverName(browser)).thenReturn(driverName);

        File mockFile = mock(File.class);
        when(mockFile.exists()).thenReturn(true);
        when(mockFile.getAbsolutePath()).thenReturn(path + "/" + driverName);

        try (var mockedFile = mockStatic(File.class)) {
            mockedFile.when(() -> new File(path, driverName)).thenReturn(mockFile);
            
            String result = fileManager.verifyDriverExists(path, browser, destination);

            assertEquals(path, result);
        }
    }

    @Test
    void testVerifyDriverExists_InParentFolder() throws IOException {
        String path = "C:/drivers";
        String browser = "firefox";
        String destination = "C:/destination";
        String driverName = "geckodriver.exe";

        when(utilities.getDriverName(browser)).thenReturn(driverName);

        File mockCurrentDir = mock(File.class);
        when(mockCurrentDir.exists()).thenReturn(false);

        File mockParentDir = mock(File.class);
        when(mockParentDir.exists()).thenReturn(true);
        when(mockParentDir.getParent()).thenReturn("C:/");

        try (var mockedFile = mockStatic(File.class)) {
            mockedFile.when(() -> new File(path, driverName)).thenReturn(mockCurrentDir);
            mockedFile.when(() -> new File(new File(path).getParent(), driverName)).thenReturn(mockParentDir);
            
            String result = fileManager.verifyDriverExists(path, browser, destination);

            assertEquals("C:/", result);
        }
    }

    @Test
    void testVerifyDriverExists_DriverNotFound() {
        String path = "C:/drivers";
        String browser = "edge";
        String destination = "C:/destination";
        String driverName = "msedgedriver.exe";

        when(utilities.getDriverName(browser)).thenReturn(driverName);

        File mockCurrentDir = mock(File.class);
        when(mockCurrentDir.exists()).thenReturn(false);

        File mockParentDir = mock(File.class);
        when(mockParentDir.exists()).thenReturn(false);

        try (var mockedFile = mockStatic(File.class)) {
            mockedFile.when(() -> new File(path, driverName)).thenReturn(mockCurrentDir);
            mockedFile.when(() -> new File(new File(path).getParent(), driverName)).thenReturn(mockParentDir);
            
            IOException exception = assertThrows(IOException.class, () -> {
                fileManager.verifyDriverExists(path, browser, destination);
            });

            assertTrue(exception.getMessage().contains("Driver not found"));
        }
    }
}




import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;

import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

class DriverManagerTest {

    private DriverManager driverManager;

    @Mock
    private Utilities utilities;  // ✅ Mocked Utilities class

    @BeforeEach
    void setUp() {
        MockitoAnnotations.openMocks(this);
        driverManager = new DriverManager(utilities);
    }

    @Test
    void testGetDriverPath_PathExists_AndWritable() {
        String browser = "chrome";
        String expectedPath = "C:/drivers/chrome";

        when(utilities.getDefaultDriverPath(browser)).thenReturn(expectedPath);
        Path mockPath = Paths.get(expectedPath);

        try (var mockedFiles = mockStatic(Files.class)) {
            mockedFiles.when(() -> Files.exists(mockPath)).thenReturn(true);
            mockedFiles.when(() -> Files.isDirectory(mockPath)).thenReturn(true);
            mockedFiles.when(() -> Files.isWritable(mockPath)).thenReturn(true);

            String result = driverManager.getDriverPath(browser);

            assertEquals(expectedPath, result);
        }
    }

    @Test
    void testGetDriverPath_PathExists_ButReadOnly() {
        String browser = "firefox";
        String expectedPath = "C:/drivers/firefox";
        String fallbackPath = System.getProperty("user.home") + "\\WebDrivers";

        when(utilities.getDefaultDriverPath(browser)).thenReturn(expectedPath);
        Path mockPath = Paths.get(expectedPath);

        try (var mockedFiles = mockStatic(Files.class)) {
            mockedFiles.when(() -> Files.exists(mockPath)).thenReturn(true);
            mockedFiles.when(() -> Files.isDirectory(mockPath)).thenReturn(true);
            mockedFiles.when(() -> Files.isWritable(mockPath)).thenReturn(false);

            String result = driverManager.getDriverPath(browser);

            assertEquals(fallbackPath, result);
        }
    }

    @Test
    void testGetDriverPath_PathDoesNotExist() {
        String browser = "edge";
        String expectedPath = "C:/drivers/edge";
        String fallbackPath = System.getProperty("user.home") + "\\WebDrivers";

        when(utilities.getDefaultDriverPath(browser)).thenReturn(expectedPath);
        Path mockPath = Paths.get(expectedPath);

        try (var mockedFiles = mockStatic(Files.class)) {
            mockedFiles.when(() -> Files.exists(mockPath)).thenReturn(false);

            String result = driverManager.getDriverPath(browser);

            assertEquals(fallbackPath, result);
        }
    }
}




import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;

class DriverUtilsTest {

    private DriverUtils driverUtils;

    @BeforeEach
    void setUp() {
        driverUtils = new DriverUtils();  // ✅ Create a real instance
    }

    @Test
    void testGetDriverName_Chrome() {
        String result = driverUtils.getDriverName("chrome");
        assertEquals("chromedriver.exe", result);
    }

    @Test
    void testGetDriverName_Edge() {
        String result = driverUtils.getDriverName("edge");
        assertEquals("msedgedriver.exe", result);
    }

    @Test
    void testGetDriverName_UnsupportedBrowser() {
        String result = driverUtils.getDriverName("firefox");
        assertEquals("Invalid browser/Not supported", result);
    }

    @Test
    void testGetDriverName_NullInput() {
        String result = driverUtils.getDriverName(null);
        assertEquals("Invalid browser/Not supported", result);
    }

    @Test
    void testGetDriverName_CaseInsensitive() {
        assertEquals("chromedriver.exe", driverUtils.getDriverName("ChRoMe"));
        assertEquals("msedgedriver.exe", driverUtils.getDriverName("EDGE"));
    }
}
